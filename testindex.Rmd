---
title: "Musicology-Portfolio"
author: "Finn Duijvestijn"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    self_contained: false
    theme:
      version: 5

---

```{r}
library(tidyverse)
library(spotifyr)
library(flexdashboard)
library(ggplot2)
library(plotly)
library(compmus)

library(cowplot)
library(patchwork)

Sys.setenv(SPOTIFY_CLIENT_ID="34c9d0d698064bf886a78b343db5445b")
Sys.setenv(SPOTIFY_CLIENT_SECRET="d0e93595f1ee411bb21938c5cb50d247")

access_token <- get_spotify_access_token()

pop <- get_playlist_audio_features("", "2AipD5zTjWWM13wk2hZmej")
phonk <- get_playlist_audio_features("", "37i9dQZF1DWWY64wDtewQt")
rap <- get_playlist_audio_features("", "37i9dQZF1DX76t638V6CA8")

awards <-
  bind_rows(
    pop |> mutate(category = "Pop"),
    phonk |> mutate(category = "Phonk"),
    rap |> mutate(category = "Rap")
    
  )
```

Introduction {.storyboard data-icon="ion-ios-home"}
=========================================

### Exploring the Unique Sounds: A Comparison of Three Distinct Music Genres
<font style="font-size: 30px">My Corpus choice</font>

My corpus consists of a collection of songs from various genres including mainly Pop, Rap, and Phonk (which is a sub

***



Visual analysis of my corpus {.storyboard data-icon="fa-signal"}
=========================================

### Self-similarity matrices

```{r self sim, echo=FALSE}
norms_chroma <- list("euclidean", "manhattan", "chebyshev")
dists_chroma <- list("manhattan", "aitchison", "cosine", "angular")
summary_chroma <- list("mean", "aitchison_centre", "root_mean_square", "max", "acentre")

norms_timbre <- list("euclidean", "manhattan", "chebyshev")
dists_timbre <- list("euclidean", "cosine", "angular")
summary_timbre <- list("mean", "root_mean_square")

taste2 <-
  get_tidy_audio_analysis("2QjOHCTQ1Jl3zawyYOpxh6") |>
  compmus_align(bars, segments) |>
  select(bars) |>
  unnest(bars) |>
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = summary_chroma[5], norm = norms_chroma[3]
      )
  ) |>
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = summary_timbre[1]
      )
  )
```

```{r self sim matrices, echo=FALSE}
self_sim <- bind_rows(
  taste2 |> 
    compmus_self_similarity(pitches, dists_chroma[1]) |> 
    mutate(d = d / max(d), type = "Chroma"),
  taste2 |> 
    compmus_self_similarity(timbre, dists_timbre[2]) |> 
    mutate(d = d / max(d), type = "Timbre")
) |>
  mutate() |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(option = "mako", guide = "none") +
  theme_classic() + 
  labs(x = "", y = "")

self_sim_ggplotly <- ggplotly(self_sim, domain = list(x=c(0,1), y=c(0.6,1)))

parts <- data.frame(
  Chroma = c("0:00 - 0:23", "0:23 - 0:49", "0:49 - 1:12", "1:12 - 1:20", "1:20 - 2:28", ""), 
  Timbre = c("0:00 - 0:23", "0:23 - 1:12", "", "1:12 - 1:20", "1:20 - 1:24", "1:24 - 1:28"),
  Chroma2 = c("", "2:28 - 3:08", "3:08 - 4:11", "", "4:11 - 4:19", ""), 
  Timbre2 = c("1:28 - 2:28", "2:28 - 3:08", "3:08 - 3:35", "3:35 - 4:11", "4:11 - 4:19", ""))
```

```{r subplot, echo=FALSE}
parts_table <- plot_ly(
    type = 'table',
    domain = list(x=c(0,1), y=c(0,0.4)),
    header = list(values = c("Chroma", "Timbre", "Chroma", "Timbre")),
    cells = list(values = rbind(parts$Chroma, parts$Timbre, parts$Chroma2, parts$Timbre2), height=25)
  )
subplot(self_sim_ggplotly, parts_table, nrows=2)
```

***

A self-similarity matrix is a visual representation of the similarity between different sections of a musical recording. The two self-similarity matrices, each summarised at the bar level but with axes in seconds, illustrate pitch- and timbre-based self-similarity within the song sweater weather.


Chroma features {.storyboard data-icon="ion-music-note"}
=========================================

### Chromas


***

Chroma can be a




What did I find {.storyboard data-icon="fa-spotify"}
=========================================

### Conclusion


### Discussion

